# Makefile for argus

APP_NAME := argus
GO_MODULE_ROOT := ../..
SOURCE_PATH := ./cmd/argus
LDFLAGS := -ldflags="-s -w"

# ê¸°ë³¸ íƒ€ê²Ÿ
.PHONY: all
all: build

# ì „ì²´ í”Œë«í¼ ë¹Œë“œ
.PHONY: build
build:
	@echo "ğŸš€ Building for all platforms..."
	@cd $(GO_MODULE_ROOT) && ./cmd/argus/build.sh

# í˜„ì¬ í”Œë«í¼ìš©ë§Œ ë¹Œë“œ (bin ë””ë ‰í† ë¦¬ì— ì €ì¥)
.PHONY: local
local:
	@echo "ğŸ”¨ Building for current platform..."
	@mkdir -p bin/current
	@cd $(GO_MODULE_ROOT) && go build -o cmd/argus/bin/current/$(APP_NAME) $(LDFLAGS) $(SOURCE_PATH)
	@echo "âœ… Built: bin/current/$(APP_NAME)"
	@echo "ğŸ’¡ ì‹¤í–‰: ./run.sh"

# Windows ë¹Œë“œ
.PHONY: windows
windows:
	@echo "ğŸ”¨ Building for Windows..."
	@mkdir -p bin/windows
	@cd $(GO_MODULE_ROOT) && GOOS=windows GOARCH=amd64 go build -o cmd/argus/bin/windows/$(APP_NAME).exe $(LDFLAGS) $(SOURCE_PATH)
	@echo "âœ… Built: bin/windows/$(APP_NAME).exe"

# Linux ë¹Œë“œ
.PHONY: linux
linux:
	@echo "ğŸ”¨ Building for Linux..."
	@mkdir -p bin/linux
	@cd $(GO_MODULE_ROOT) && GOOS=linux GOARCH=amd64 go build -o cmd/argus/bin/linux/$(APP_NAME) $(LDFLAGS) $(SOURCE_PATH)
	@echo "âœ… Built: bin/linux/$(APP_NAME)"

# macOS Intel ë¹Œë“œ
.PHONY: darwin-amd64
darwin-amd64:
	@echo "ğŸ”¨ Building for macOS (Intel)..."
	@mkdir -p bin/darwin/amd64
	@cd $(GO_MODULE_ROOT) && GOOS=darwin GOARCH=amd64 go build -o cmd/argus/bin/darwin/amd64/$(APP_NAME) $(LDFLAGS) $(SOURCE_PATH)
	@echo "âœ… Built: bin/darwin/amd64/$(APP_NAME)"

# macOS Apple Silicon ë¹Œë“œ
.PHONY: darwin-arm64
darwin-arm64:
	@echo "ğŸ”¨ Building for macOS (Apple Silicon)..."
	@mkdir -p bin/darwin/arm64
	@cd $(GO_MODULE_ROOT) && GOOS=darwin GOARCH=arm64 go build -o cmd/argus/bin/darwin/arm64/$(APP_NAME) $(LDFLAGS) $(SOURCE_PATH)
	@echo "âœ… Built: bin/darwin/arm64/$(APP_NAME)"

# ì‹¤í–‰ (í˜„ì¬ í”Œë«í¼)
.PHONY: run
run: local
	@./run.sh

# ì •ë¦¬
.PHONY: clean
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@rm -rf bin/
	@rm -f $(APP_NAME) $(APP_NAME).exe
	@echo "âœ… Cleaned"

# ì„¤ì¹˜ (í˜„ì¬ í”Œë«í¼ìš©ì„ ì‹œìŠ¤í…œì— ì„¤ì¹˜)
.PHONY: install
install: local
	@echo "ğŸ“¦ Installing to /usr/local/bin..."
	@sudo cp bin/current/$(APP_NAME) /usr/local/bin/
	@sudo chmod +x /usr/local/bin/$(APP_NAME)
	@echo "âœ… Installed to /usr/local/bin/$(APP_NAME)"

# ë„ì›€ë§
.PHONY: help
help:
	@echo "argus Makefile"
	@echo ""
	@echo "Usage:"
	@echo "  make [target]"
	@echo ""
	@echo "Targets:"
	@echo "  all            Build for all platforms (default)"
	@echo "  build          Build for all platforms"
	@echo "  local          Build for current platform only"
	@echo "  windows        Build for Windows only"
	@echo "  linux          Build for Linux only"
	@echo "  darwin-amd64   Build for macOS Intel only"
	@echo "  darwin-arm64   Build for macOS Apple Silicon only"
	@echo "  run            Build and run locally"
	@echo "  clean          Remove all build artifacts"
	@echo "  install        Install to /usr/local/bin (requires sudo)"
	@echo "  help           Show this help message"
